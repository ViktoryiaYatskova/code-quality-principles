# Качество кода

## Зачем?

Примеры плохого и хорошего проекта?

Что может случится?

// TODO: написать

## Общие принципы

### 1. DRY — *Don't Repeat Yourself*
or **DIE** — _Duplication Is Evil_


_Дублирование это зло!_

Принцип призывает Вас не повторяться при написании кода. Все, что Вы пишите в проекте, должно быть определено только один раз.
При не соблюдении этого принципа, программист будет вынужден вносить изменения в несколько повторяющихся фрагментов кода, вместо одного. Также дублирующийся код приводит к разрастанию программы, а значит, усложняет ее понимание, читабельность.

</details>

<details>
    <summary>
    Хочу знать больше:
    </summary>

**История:**
Принцип был впервые упомянут в книге  ["Программист-прагматик" Эндрю Ханта](https://ideafix.name/wp-content/uploads/stuff/book51.pdf) (1999). Однако ещё до выхода книги в свет он был широкоизвестен и повсеместно применялся. В то же время "Программист-прагматик точно определил принцип и дал ему имя.

В книге DRY описывается как:

> "Каждый фрагмент знания должен иметь единственное. однозначное,
> надежное представление в системе",

где под "фрагментом знаний" можно понимать как функциональный логически-завершенный кусок кода вашего приложения или алгоритм.

</details>

#### Примеры:

<details>
	<summary> 
		1. CSS: Группировка селекторов
	</summary>

```
h1 {
  color: #ff0000;
  font-family: Arial;
}
h2 {
  color: #ff0000;
  font-family: Arial;
}
h3 {
  color: #ff0000;
  font-family: Arial;
}
h4 {
  color: #ff0000;
  font-family: Arial;
}
```

С использованием группировки селекторов CSS этот же код может быть написан так:

```
h1, h2, h3, h4 {
  color: #ff0000;
  font-family: Arial;
}
```

</details>

<details>
	<summary> 
		2. CSS: Повторяющиеся группы стилей в классы
	</summary>

Если один набор CSS-свойств задает стиль нескольких элементов на странице, то такую обычно объединяют в одним CSS-класс:  

```
p {
	margin-botton: 10px;
	text-indent: 10px;
}

/* Re-used styles */
.quotation {
    font-family: "Helvetica";
    font-style: italic;
    text-indent: 20px;
}

.bold-text {
    font-weight: bold;
}
```

```
<section>
	<h2 class="bold-text">Жалобная книга</h2>
	<p>
	Лежит она, эта книга, в специально построенной для нее конторке на станции железной дороги. Ключ от конторки «хранится у станционного жандарма», на деле же никакого ключа не нужно, так как конторка всегда отперта. Раскрывайте книгу и читайте:
	</p>
	<p class="quotation">«Милостивый государь! Проба пера!?»<p>
	<p>Под этим нарисована рожица с длинным носом и рожками. Под рожицей написано:</p>	
	<p class="quotation">«Ты картина, я портрет, ты скотина, а я нет. Я — морда твоя».</p>
	<p>«Подъезжая к сией станцыи и глядя на природу в окно, у меня слетела шляпа. И. Ярмонкин».</p>
</section>

```

</details>

<details>
	<summary> 
		3. JS: Циклы
	</summary>

```
// non DRY code
console.log('corn');
console.log('pita');
console.log('potato');
console.log('tortilla');
```

```
// DRY code
const chips = ['corn', 'pita', 'potato', 'tortilla'];

for ( let i = 0; i < chips.length; i++) {
    console.log(chips[i]);
}
```
</details>

<details>
	<summary> 
		4. JS: Функции
	</summary>

Дублирующуюся логику удобно выносить в функции.

```
const today = new Date();
const weekday = today.getDay();

// non DRY code
if (weekDay === 'Sunday' || weekDay === 'Saturday' ) {
    console.log('Today is ', today, 'So my day plan includes: ', 'sleep, eat, rest');
} else {
    console.log('Today is ', today, 'So my day plan includes: ', 'work, work, work');
}

// DRY code
const today = new Date();
const weekday = today.getDay();

// non DRY code
if (weekDay === 'Sunday' || weekDay === 'Saturday' ) {
    logDayPlan(today, 'sleep, eat, rest');
} else {
    logDayPlan(today, 'work, work, work');
}

function logDayPlan(weekday, tasks) {
    console.log('Today is ', weekday, 'So my day plan includes: ', tasks);
}

```
</details>

### 2. KISS — _keep it short simple / keep it simple, stupid_

_Делайте вещи проще!_

Порой наиболее правильное решение – это наиболее простая реализация задачи, в которой нет ничего лишнего.

Чем проще код, тем легче в нем разобраться, как вам, так и другим людям, занимающимся его поддержкой. Под простотой главным образом имеется в виду отказ от использования хитроумных приемов и ненужного усложнения.


<details>
    <summary>Примеры:</summary>

В качестве примера нарушения этого принципа можно назвать написание отдельной функции только лишь для осуществления операции сложения или использование побитового оператора (right shift >> 1) для деления целых чисел на 2.

`(4 >> 1) === (4 / 2)` 

Последнее, безусловно, более эффективно, чем обычное деление ( / 2 ), но при этом очень сильно снижается понятность кода. Применяя такой подход, вы осуществляете clever coding («заумный» кодинг) и over-optimization (чрезмерную оптимизацию). И то, и другое в долгосрочной перспективе будет делать ваш код все менее и менее понятным как другим разработчикам, так и вам самим, ведь возможно вам придётся разбираться с этим кодом снова через месяц, два, год.

</details>

<details>
    <summary>Хочу знать больше:</summary>

**История:** 

Принцип проектирования, принятый в военно-морских силах США в 1960. Принцип KISS утверждает, что большинство систем работают лучше всего, если они остаются простыми, а не усложняются. Поэтому в области проектирования простота должна быть одной из ключевых целей, и следует избегать ненужной сложности. Фраза ассоциировалась с авиаконструктором Кларенсом Джонсоном (1910—1990). В 1970-х гг. широко использовался термин «KISS-принцип» (англ. KISS principle). Вариации на фразу включают «англ. Keep it Simple, Silly», «keep it short and simple», «keep it simple and straightforward» и «keep it small and simple».

[Еще больше на Википедии](https://ru.wikipedia.org/wiki/KISS_(%D0%BF%D1%80%D0%B8%D0%BD%D1%86%D0%B8%D0%BF))

</details>

### 3. YAGNI — _You ain't gonna need it_

_Вам это не понадобится!_

Все, что не предусмотрено заданием проекта, не должно быть в нем.

Проще говоря, вам не стоит писать функциональность наперед, если прямо сейчас в ней нет необходимости. Желание написать код на будущее может иметь много неприятных последствий: 

- Вы тратите драгоценное время, которое могло бы быть использовано на добавление, тестирование и улучшение действительно необходимой функциональности.
- Новые функции должны быть протестированы, задокументированы.
- Ваши ненужные новые функции могут впоследствии помешать добавить новые, но уже нужные.
- Если написанный код в итоге понадобится, он может оказаться неправильным. 
- Лишний код может в итоге никогда и не понадобиться.
- Лишний код усложняет вашу программу (см. KISS).
- Добавление новой ненужной функциональности может привести к желанию добавить ещё больше новой лишней функциональности, приводя к эффекту «снежного кома».

[Мартин Фаулер о YAGNI](https://martinfowler.com/bliki/Yagni.html)

### 4. Комментарии

Поясняй код при необходимости, где это возможно.

Используйте комментирации для пояснения кода:

- что он покрывет?
- какова его задача?
- почему такое решение используется или предпочтительно?

В тоже время не стоит пытаться покрыть комментариями весь код. Использование значимых названий переменных и функций, разбитие кода на логические фрагменты с помощью функции и другие практики помогают сделать код максимально читаемым и понятным, не прибегая к комментариям (самодокументирующийся код). 

Тем не менее, бывают случаи, когда поясняющие комментарии нужны, вне зависимости от того, как выглядит ваш код.

Обычно это происходит, когда вам нужно добавить контекст к неинтуитивному решению.


```
// Not recommended
const MAIN_TEXT_COLOUR = '#000000'; // colour for main text on the page
```
Комментарий тут излишен, так как он поясняет очевидное из названия переменной назначение константы.

А вот хороший пример из библиотеки Lodash:

```
// Recommended

function addSetEntry(set, value) {   
  // Don't return `set.add`, as this call chain doesn't work in Internet Explorer 11
  set.add(value);    
  return set;  
}

```
[Подробнее о комментариях](https://learn.javascript.ru/comments)

#### 4.1 Отложенные задачи (TODO)
_Частный случай комментариев_

TODO - от англ. *to do* (пер. "сделать") используется для обозначения запланированного изменения прямо в комментариях кода. Обычно эта задача относится к несрочным изменениям, но достаточно важным. Поэтому разработчики прямо в коде оставляют своего рода напоминае себе и другим программистам.

- Впереди такой пометки используйте префикс "ТODO: ...".
- Используйте только данный тип обозначения для TODO-задач.

```
// TODO: move this magic number (15 rows) to the configuration file
for (let i = 0; i < 15; i++) {
    const row = document.createElement('tr');
    table.appendChild(row);
}
```
```
<!-- TODO: remove optional tags -->
<ul>
  <li>Apples</li>
  <li>Oranges</li>
</ul>
```


### 5. Пробелы в конце строки

*англ. Trailing whitespaces*

Пробелы в конце строки являются излишними, к тому же они усложняют commit-изменения в Github (вы видите лишнюю строчку/символ изменений, не несущего смыслового изменения)

```
<!-- Not recommended -->
<p>What?_

<!-- Recommended -->
<p>Yes please. 
```

### 6. Именование файлов

Придерживайтесь единого стиля именования файлов в проекте.
Рекомендуем использовать нижний регистр написания с разделением слов дефисом.

Также удобно разделять файлы на `/js`, `/assets`, `/styles` (если иное не указано в тексте задания). Покомпонентная структура папок тоже приемлема (имеется в виду, хранение в одной папке всех файлов относящихся к определенной компоненте). 

```
/assets
	right-arrow-image.svg
	left-arrow-image.svg
/js
	app.js
	image-slider.js
/styles
	basic.css
	image-slider.css
/html	
	index.html
	image-slider.html
``` 

## Общие правила для HTML + CSS

## Уровень 1:

### 1. Отступы

Всегда используйте для одного отступа два пробела.
Не используйте табуляцию (tab-символ) для отступов и не смешивайте виды отступов (tab и пробелы одновременно).

<details>
    <summary>Почему?</summary>

Так как над проектами работает команда людей, то зачастую один исходный код проекта отображается в различных редакторах кода. Проблемы начинаются тогда, когда в одном файле используются разные методы идентации. Так как каждый редактор кода по разному отображает tab-отступ, то красивый файл в вашей IDE, может выглядеть совсем несуразно в другой.

[Источник](https://dev.by/news/otstupy-tab-ili-probel-programmist-proanaliziroval-milliard-faylov-i-nashyol-otvet)

</details>

```
<ul>
  <li>Fantastic
  <li>Great
</ul>

.example {
  color: blue;
}
```

### 2. Нижний регистр написания

Весь код должен быть в нижнем регистре. Это касается всех HTML-имен, включая названия атрибутов, значения атрибутов, CSS-селекторы, CSS-свойства и их значения.

```
<!-- Not recommended -->
<A HREF="/">Home</A>

<!-- Recommended -->
<img src="google.png" alt="Google">
```

```
/* Not recommended */
color : #E5E5E5 ;

/* Recommended */
color : #e5e5e5 ;
```

### 3. Кавычки в HTML/CSS документе

Используйте двойные кавычки вместо одинарных для задания значений атрибутов.

```
<!-- Not recommended -->
<a class='main-button main-button-secondary'>Sign in</a>

<!-- Recommended -->
<a class="main-button main-button-secondary">Sign in</a>
```


## HTML

## Уровень 1:

### 1.Форматирование

Выделяйте новую строку для каждого блочного, табличного или списочного элемента, независимо от заданных для них стилей. И ставьте отступы для каждого вложенного элемента.

**Примеры:**

```
<blockquote>
  <p><em>Space</em>, the final frontier.</p>
</blockquote>
```

```
<ul>
	<li>Маша</li>
	<li>Глаша</li>
	<li>Чебураша</li>
</ul>
```
```
<table>
   <thead>
   	  <tr>
        <th scope="col">Прибыль</th>
        <th scope="col">Налоги</th>
     <tr>
   </thead>
   <tbody>
      <tr>
        <td>$ 5.00</td>
        <td>$ 4.50</td>
      <tr>
   </tbody>
</table>
```

### 2. Тип документа / Document Type 

Используйте HTML5.

HTML5 рекомендуется для всех видов HTML-документов и обозначается первым тегом в HTML документе: 
`<!DOCTYPE html>`


### 3. Символы-мнемоники
Не используйте символы-мнемоники.

Нет смысла использовать мнемоники, такие как `&mdash;`(&mdash;), `&rdquo;`(&rdquo;) или `&#x263a;`(&#x263a;), когда все команды в файлах, редакторах используют одну кодировку (UTF-8)

Единственное исключение из этого правила — служебные символы HTML (например < и &), а так же вспомогательные и “невидимые” символы (например неразрывный пробел).

```
<!-- Not recommended -->
<div>Валютный знак евро: &ldquo;&eur;&rdquo;.</div>
 
 <!--  Recommended -->
<div>Валютный знак евро: “€”. </div>
```

### 4. Атрибут 'type'

Не указывайте атрибут `type` при подключении стилей и скриптов в документ.

Не используйте атрибут `type` при подключении стилей (кроме вариантов когда используется что-то кроме CSS) и скриптов (кроме вариантов когда это не JavaScript).

<details>
	<summary>Почему?</summary>
	Указывать атрибут type в данном случае не обязательно потому что HTML5 использует text/css (англ.) и text/javascript (англ.) по умолчанию.
	Это будет работать даже в старых браузерах.
</details>

```
<!--  Not recommended -->
<link rel="stylesheet" href="//www.google.com/css/main.css"
  type="text/css">

<!--  Recommended -->
<link rel="stylesheet" href="//www.google.com/css/main.css">

```
```
<!--  Not recommended -->
<script src="//www.google.com/js/gweb/analytics/autotrack.js"
  type="text/javascript"></script>

<!--  Recommended -->
<script src="//www.google.com/js/gweb/analytics/autotrack.js"></script>
```


## Уровень 2:

### 5. Семантика
Используйте HTML так, как это было задумано.

Используйте элементы по назначению: заголовки для заголовков, p для абзацев, a для ссылок и т.д.

Почему? 
Это облегчает чтение, редактирование и поддержку кода.


```
<!-- Not recommended -->
<div onclick="goToRecommendations();">
	All recommendations
</div>

<!-- Recommended -->
<a href="recommendations/">
	All recommendations
</a>
```

### 6. Альтернатива для мультимедиа

Всегда указывайте альтернативное содержимое для мультимедиа.

Постарайтесь указать альтернативное содержимое для мультимедиа: например для картинок, видео или анимаций, заданных с помощью canvas.

Для картинок это осмысленный альтернативный текст (alt), а для видео и аудио - расшифровки текста и подписи, если это возможно.

<details>
    <summary>Почему?</summary>

Альтернативное содержимое может помочь людям с с ограниченными возможностями. Например человеку со слабым зрением сложно понять, что на картинке, если для нее не задан `alt`. Другим людям может быть тяжело понять, о чем говорится в видео или аудио записи.

</details>

(Если для картинки alt избыточен, или она используется только в декоративных целях в местах, где нельзя использовать CSS, используйте пустой альтернативный текст `alt=""`)

```
<!-- Not recommended -->
<img src="spreadsheet.png">

<!-- Recommended -->
<img src="spreadsheet.png"alt="Spreadsheet screenshot">
```

##  Опциональные рекомендации:

### HTML Line-Wrapping

Разбивайте длинные строки на несколько.

Разбиение длинного текста на несколько строк может значительно улучшить читаемость кода.

При разбиении строк рекомендуется перед каждой перенесенной строкой от начальной поставить отступ хотя бы в 4 пробела.

**Примеры:**

```
<md-progress-circular md-mode="indeterminate" class="md-accent"
    ng-show="ctrl.loading"md-diameter="35">
</md-progress-circular>

```

```
<md-progress-circular
    md-mode="indeterminate"
    class="md-accent"
    ng-show="ctrl.loading"
    md-diameter="35">
</md-progress-circular>
```
```
<md-progress-circular md-mode="indeterminate"
                      class="md-accent"
                      ng-show="ctrl.loading"
                      md-diameter="35">
</md-progress-circular>
```


## CSS

## Уровень 1:

### 1. Единый стиль именования селекторов (классов / id)

Какой бы стиль написания имен вы не выбрали, соблюдайте его во всем проекте. 

Если вы используете БЭМ, придерживайтесь этой нотации без исключения. 

Иначе рекомендуется использовать дефис для разделения слов в селекторах. 

[Подробнее о БЭМ](https://ru.bem.info/methodology/quick-start/)

```
/* Не рекомендуется: слова “demo” и “image” не разделены */
.demoimage {}
  
/* Не рекомендуется: используется подчеркивание вместо дефиса */
.error_status {}

/* Рекомендуется */
#video-id {}
.ads-sample {}


/* Рекомендуется в случае использования БЭМ */
.search-form__button {}
```

### 2. Значимые названия идентификаторов и классов: 

Используйте шаблонные или осмысленные имена классов и идентификаторы.

Вместо использования шифров, или описания внешнего вида элемента, попробуйте в имени класса или идентификатора выразить смысл его создания, или дайте ему шаблонное имя…

рекомендуется выбирать имена, отражающие сущность класса, потому что их проще понять и, скорее всего, не понадобится менять в будущем.

Шаблонные имена — это просто вариант названия для элементов, у которых нет специального предназначения или которые не отличаются от своих братьев и сестер. Обычно они необходимы в качестве “Помощников”.

Использование функциональных или шаблонных имен уменьшает необходимость ненужных изменений в документа или шаблонах.

```
/* Не рекомендуется: не имеет смысла */
  #yee-1901 {}
  
/* Не рекомендуется: описание внешнего вида */
  .button-green {}
  .clear {}
  
```
```
/* Рекомендуется: точно и по делу */
  #gallery {}
  #login {}
  .video {}
  
/* Рекомендуется: шаблонное имя */
  .clearfix {}
  .alt {}
``` 

### 3. Лаконичность названий идентификаторов и классов

Для идентификаторов и классов используйте настолько длинные имена, насколько нужно, но настолько короткие, насколько возможно.

Попробуйте сформулировать, что именно должен делать данный элемент, при этом будьте кратки насколько возможно.

Такое использование классов и идентификаторов вносит свой вклад в облегчение понимания и увеличение эффективности кода.

```
  /* Не рекомендуется */
  #navigation {}
  .atr {}
```

```
  /* Рекомендуется */
  #nav {}
  .author {}
```

### 4.Теговые селекторы

Избегайте использование имен классов или идентификаторов с селекторами тега элемента.

Кроме случаев когда это не обходимо (например с классами-помощниками), не используйте названия элементов с именами классов или идентификаторами.

Это повышает производительность.

[Подробнее о производительности](https://www.stevesouders.com/blog/2009/06/18/simplifying-css-selectors/)

```
  /* Не рекомендуется */
  ul#example {}
  div.error {}

  /* Рекомендуется */
  #example {}
  .error {}
```


### 5.Отступы в блоках.
Всегда ставьте отступы для содержимого блоков.

Всегда ставьте отступы для любого содержимого в блоке (блоки разделены фигурными скобками {}).
Например для правил внутри правил или объявлений, чтобы отобразить иерархию и облегчить понимание кода.

```
@media screen, projection {
  
  html {
    background: #fff;
    color: #444;
  }
    
}
```

### 6. Пробел после названий свойств
Используйте пробелы после двоеточий в объявлениях.

Всегда используйте один пробел после двоеточия (но не до) в объявлениях, для порядка в коде.

```
/* Not recommended */
  h3 {
    font-weight:bold;
  }

/* Recommended */
  h3 {
    font-weight: bold;
  }
  
```


### 7. Точка с запятной после свойств

Ставьте точку с запятой после каждого свойства.

После каждого объявления ставьте точку с запятой для согласованности кода и облегчения добавления новых свойств

```
/* Not recommended */
.test {
    display: block;
    height: 100px
}

/* Recommended */
.test {
    display: block;
    height: 100px;
}
 
```

### 8. Разделение селекторов и свойств

Отделяйте селекторы и свойства переносом строки.

Начинайте каждый селектор или правило с новой строки.

```
/* Not recommended */
  a:focus, a:active {
    position: relative; top: 1px;
  }

/* Recommended */
  h1,
  h2,
  h3 {
    font-weight: normal;
    line-height: 1.2;
  }
  
```


## Уровень 2:

### 9. БЭМ

Используйте БЭМ нотация для формирования имен классов и идентификаторов

БЭМ (Блок, Элемент, Модификатор) — компонентный подход к веб-разработке. В его основе лежит принцип разделения интерфейса на независимые блоки. Он позволяет легко и быстро разрабатывать интерфейсы любой сложности и повторно использовать существующий код, избегая «Copy-Paste». 

БЭМ берет свое начало в компании Яндекс, однако распространился далеко за ее пределы.

В кратце в основе БЭМ лежит идея разделения любой интерфейс на блоки. Неотделимые части блоков — элементы. У тех и других есть модификаторы.

```
<ul class="menu">
  <li class="
    menu__item">
  </li>
  <li class="
    menu__item
    menu__item_active">
  </li>
</ul>
```

Например, блок меню сайта. Оно может быть в шапке и в боковой части сайта — значит, это блок. В нём есть обязательные части: элементы списка меню, заголовок — это его элементы. Если какой-то элемент меню является активным, то ему даётся модификатор.

[Подробнее о БЭМ](https://ru.bem.info/methodology/quick-start/)


## JS

- Волшебные числа (Magic numbers)
- Еще раз про дубликацию кода
	- Выноси повторяющуюся логику в функции
- Избегай вложенных функций
- Небольшие функции
- Одна функция - одно назначение

## GIT Commits

## Автоматизируй это!
 Или как упростить себе жизнь

// TODO: написать

- ESLint (Что это? Установка локально, интеграция в разные IDE)
- Хуки (precommit / prepush; что это? Как настроить)
- Интеграция job в Github repositories (Ура уже установлено, но можно рассказать, как это работает)
- SonarQube и другие инструменты